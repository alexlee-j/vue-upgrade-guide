<template>
  <div class="reactivity-page">
    <h1>ğŸ”„ å“åº”æ€§ç³»ç»Ÿ</h1>
    <p class="page-description">
      æ·±å…¥äº†è§£ Vue 3 çš„å“åº”æ€§ç³»ç»Ÿï¼ŒæŒæ¡å…¶å·¥ä½œåŸç†å’Œä½¿ç”¨æ–¹æ³•
    </p>
    
    <section class="section-card">
      <h2>Vue 3 å“åº”æ€§ç³»ç»Ÿæ¦‚è¿°</h2>
      <p>Vue 3 å¼•å…¥äº†åŸºäº Proxy çš„å…¨æ–°å“åº”æ€§ç³»ç»Ÿï¼Œç›¸æ¯” Vue 2 çš„ Object.defineProperty å®ç°ï¼Œæä¾›äº†æ›´å¥½çš„æ€§èƒ½å’Œæ›´å®Œæ•´çš„å“åº”å¼èƒ½åŠ›ã€‚</p>
      <ul>
        <li><strong>åŸºäº Proxyï¼š</strong>ä½¿ç”¨ ES6 Proxy å®ç°ï¼Œèƒ½å¤Ÿæ‹¦æˆªæ›´å¤šçš„å¯¹è±¡æ“ä½œ</li>
        <li><strong>è‡ªåŠ¨è¿½è¸ªï¼š</strong>æ™ºèƒ½è¿½è¸ªå“åº”å¼æ•°æ®çš„ä¾èµ–å…³ç³»</li>
        <li><strong>ç²¾ç¡®æ›´æ–°ï¼š</strong>åªæ›´æ–°å—å½±å“çš„ç»„ä»¶ï¼Œæé«˜æ€§èƒ½</li>
        <li><strong>æ”¯æŒæ›´å¤šç±»å‹ï¼š</strong>å¯ä»¥ç›‘å¬ Mapã€Setã€WeakMapã€WeakSet ç­‰é›†åˆç±»å‹</li>
      </ul>
    </section>
    
    <section class="section-card">
      <h2>ä¸ Vue 2 å“åº”æ€§ç³»ç»Ÿçš„å¯¹æ¯”</h2>
      <div class="comparison-grid">
        <div class="comparison-item">
          <h3>Vue 2 å“åº”æ€§ç³»ç»Ÿ</h3>
          <ul>
            <li>åŸºäº Object.defineProperty å®ç°</li>
            <li>åªèƒ½ç›‘å¬å¯¹è±¡çš„å±æ€§è®¿é—®å’Œä¿®æ”¹</li>
            <li>æ— æ³•æ£€æµ‹å¯¹è±¡å±æ€§çš„æ·»åŠ å’Œåˆ é™¤</li>
            <li>æ— æ³•æ£€æµ‹æ•°ç»„ç´¢å¼•å’Œé•¿åº¦çš„å˜åŒ–</li>
            <li>éœ€è¦ä½¿ç”¨ Vue.set æˆ– this.$set æ‰‹åŠ¨è§¦å‘å“åº”</li>
            <li>å¯¹åµŒå¥—å¯¹è±¡çš„å“åº”å¼å¤„ç†éœ€è¦é€’å½’éå†</li>
          </ul>
        </div>
        <div class="comparison-item">
          <h3>Vue 3 å“åº”æ€§ç³»ç»Ÿ</h3>
          <ul>
            <li>åŸºäº ES6 Proxy å®ç°</li>
            <li>å¯ä»¥æ‹¦æˆªæ›´å¤šçš„å¯¹è±¡æ“ä½œï¼ˆgetã€setã€deleteProperty ç­‰ï¼‰</li>
            <li>èƒ½å¤Ÿæ£€æµ‹å¯¹è±¡å±æ€§çš„æ·»åŠ å’Œåˆ é™¤</li>
            <li>èƒ½å¤Ÿæ£€æµ‹æ•°ç»„ç´¢å¼•å’Œé•¿åº¦çš„å˜åŒ–</li>
            <li>ä¸éœ€è¦æ‰‹åŠ¨è§¦å‘å“åº”ï¼Œè‡ªåŠ¨å¤„ç†</li>
            <li>å¯¹åµŒå¥—å¯¹è±¡çš„å“åº”å¼å¤„ç†æ˜¯æƒ°æ€§çš„ï¼Œæé«˜æ€§èƒ½</li>
            <li>æ”¯æŒæ›´å¤šçš„é›†åˆç±»å‹</li>
          </ul>
        </div>
      </div>
    </section>
    
    <section class="section-card">
      <h2>æ ¸å¿ƒå“åº”æ€§ API</h2>
      <div class="api-grid">
        <div class="api-item">
          <h3>ref()</h3>
          <p>åˆ›å»ºä¸€ä¸ªå“åº”å¼çš„ ref å¯¹è±¡ï¼Œç”¨äºåŸºæœ¬ç±»å‹æ•°æ®</p>
          <div class="code-example">
            <pre><code>import { ref } from 'vue'

// åˆ›å»º ref
const count = ref(0)

// è®¿é—®å€¼
console.log(count.value) // 0

// ä¿®æ”¹å€¼
count.value++
console.log(count.value) // 1

// åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ï¼ˆä¸éœ€è¦ .valueï¼‰
// {{ count }}</code></pre>
          </div>
        </div>
        <div class="api-item">
          <h3>reactive()</h3>
          <p>åˆ›å»ºä¸€ä¸ªå“åº”å¼çš„ä»£ç†å¯¹è±¡ï¼Œç”¨äºå¤æ‚ç±»å‹æ•°æ®</p>
          <div class="code-example">
            <pre><code>import { reactive } from 'vue'

// åˆ›å»ºå“åº”å¼å¯¹è±¡
const state = reactive({
  name: 'Vue 3',
  version: '3.4.0',
  features: ['Composition API', 'Proxy-based reactivity']
})

// ç›´æ¥è®¿é—®å’Œä¿®æ”¹å±æ€§
console.log(state.name) // Vue 3
state.version = '3.4.1'

// æ·»åŠ æ–°å±æ€§ï¼ˆVue 3 æ”¯æŒï¼‰
state.author = 'Evan You'

// åˆ é™¤å±æ€§ï¼ˆVue 3 æ”¯æŒï¼‰
delete state.features</code></pre>
          </div>
        </div>
        <div class="api-item">
          <h3>computed()</h3>
          <p>åˆ›å»ºä¸€ä¸ªå“åº”å¼çš„è®¡ç®—å±æ€§ï¼Œå…·æœ‰ç¼“å­˜æœºåˆ¶</p>
          <div class="code-example">
            <pre><code>import { ref, computed } from 'vue'

const count = ref(0)

// åˆ›å»ºè®¡ç®—å±æ€§
const doubleCount = computed(() => {
  console.log('Computing doubleCount')
  return count.value * 2
})

// é¦–æ¬¡è®¿é—®ä¼šè®¡ç®—
console.log(doubleCount.value) // 0

// ä¿®æ”¹ä¾èµ–
count.value++

// å†æ¬¡è®¿é—®ä¼šä½¿ç”¨ç¼“å­˜
console.log(doubleCount.value) // 2

// ä¾èµ–å˜åŒ–æ—¶ä¼šé‡æ–°è®¡ç®—
count.value++
console.log(doubleCount.value) // 4</code></pre>
          </div>
        </div>
        <div class="api-item">
          <h3>watch()</h3>
          <p>ç›‘å¬å“åº”å¼æ•°æ®çš„å˜åŒ–ï¼Œæ‰§è¡Œå‰¯ä½œç”¨</p>
          <div class="code-example">
            <pre><code>import { ref, watch } from 'vue'

const count = ref(0)

// ç›‘å¬å•ä¸ª ref
watch(count, (newValue, oldValue) => {
  console.log(`Count changed from ${oldValue} to ${newValue}`)
})

// ç›‘å¬å¤šä¸ªæº
const message = ref('Hello')
watch([count, message], ([newCount, newMessage], [oldCount, oldMessage]) => {
  console.log('Count or message changed')
})

// ç›‘å¬å¯¹è±¡å±æ€§
const state = reactive({ name: 'Vue' })
watch(() => state.name, (newName, oldName) => {
  console.log(`Name changed from ${oldName} to ${newName}`)
})</code></pre>
          </div>
        </div>
      </div>
    </section>
    
    <section class="section-card">
      <h2>é«˜çº§å“åº”æ€§ API</h2>
      <div class="api-grid">
        <div class="api-item">
          <h3>shallowRef() / shallowReactive()</h3>
          <p>åˆ›å»ºæµ…å±‚å“åº”å¼å¯¹è±¡ï¼Œåªå“åº”é¡¶å±‚å±æ€§çš„å˜åŒ–</p>
          <div class="code-example">
            <pre><code>import { shallowRef, shallowReactive } from 'vue'

// æµ…å±‚ ref
const shallowCount = shallowRef({ value: 0 })
// ä¿®æ”¹åµŒå¥—å±æ€§ä¸ä¼šè§¦å‘æ›´æ–°
shallowCount.value.value++

// æµ…å±‚ reactive
const shallowState = shallowReactive({ 
  user: { name: 'John' } 
})
// ä¿®æ”¹åµŒå¥—å±æ€§ä¸ä¼šè§¦å‘æ›´æ–°
shallowState.user.name = 'Jane'</code></pre>
          </div>
        </div>
        <div class="api-item">
          <h3>triggerRef() / effectScope()</h3>
          <p>æ‰‹åŠ¨è§¦å‘å“åº”å’Œç®¡ç†å‰¯ä½œç”¨ä½œç”¨åŸŸ</p>
          <div class="code-example">
            <pre><code>import { shallowRef, triggerRef, effectScope } from 'vue'

// æ‰‹åŠ¨è§¦å‘å“åº”
const shallowCount = shallowRef({ value: 0 })
shallowCount.value.value++
triggerRef(shallowCount) // æ‰‹åŠ¨è§¦å‘æ›´æ–°

// ç®¡ç†å‰¯ä½œç”¨ä½œç”¨åŸŸ
const scope = effectScope()
scope.run(() => {
  // å“åº”å¼å‰¯ä½œç”¨
  watch(count, () => {
    console.log('Count changed')
  })
})

// é”€æ¯ä½œç”¨åŸŸå†…çš„æ‰€æœ‰å‰¯ä½œç”¨
scope.stop()</code></pre>
          </div>
        </div>
        <div class="api-item">
          <h3>toRef() / toRefs()</h3>
          <p>å°†å“åº”å¼å¯¹è±¡çš„å±æ€§è½¬æ¢ä¸º refï¼Œä¿æŒå“åº”æ€§</p>
          <div class="code-example">
            <pre><code>import { reactive, toRef, toRefs } from 'vue'

const state = reactive({ 
  name: 'Vue', 
  version: '3.4.0' 
})

// å•ä¸ªå±æ€§è½¬æ¢ä¸º ref
const nameRef = toRef(state, 'name')

// æ‰€æœ‰å±æ€§è½¬æ¢ä¸º ref
const stateRefs = toRefs(state)
console.log(stateRefs.name.value) // Vue
console.log(stateRefs.version.value) // 3.4.0</code></pre>
          </div>
        </div>
        <div class="api-item">
          <h3>customRef()</h3>
          <p>åˆ›å»ºè‡ªå®šä¹‰çš„ refï¼Œæ§åˆ¶ä¾èµ–è¿½è¸ªå’Œè§¦å‘æ›´æ–°çš„æ—¶æœº</p>
          <div class="code-example">
            <pre><code>import { customRef } from 'vue'

// åˆ›å»ºå¸¦é˜²æŠ–çš„ ref
function useDebouncedRef(value, delay = 300) {
  let timeout
  return customRef((track, trigger) => ({
    get() {
      track() // è¿½è¸ªä¾èµ–
      return value
    },
    set(newValue) {
      clearTimeout(timeout)
      timeout = setTimeout(() => {
        value = newValue
        trigger() // è§¦å‘æ›´æ–°
      }, delay)
    }
  }))
}

// ä½¿ç”¨
const searchQuery = useDebouncedRef('')</code></pre>
          </div>
        </div>
      </div>
    </section>
    
    <section class="section-card">
      <h2>æœ€ä½³å®è·µ</h2>
      <ul>
        <li><strong>é€‰æ‹©åˆé€‚çš„å“åº”å¼ APIï¼š</strong>æ ¹æ®æ•°æ®ç±»å‹å’Œä½¿ç”¨åœºæ™¯é€‰æ‹© ref æˆ– reactive</li>
        <li><strong>é¿å…æ·±åº¦åµŒå¥—ï¼š</strong>æ·±åº¦åµŒå¥—çš„å“åº”å¼å¯¹è±¡ä¼šå½±å“æ€§èƒ½ï¼Œè€ƒè™‘æ‰å¹³åŒ–æ•°æ®ç»“æ„</li>
        <li><strong>åˆç†ä½¿ç”¨è®¡ç®—å±æ€§ï¼š</strong>å¯¹äºå¤æ‚çš„æ´¾ç”ŸçŠ¶æ€ï¼Œä½¿ç”¨è®¡ç®—å±æ€§ç¼“å­˜ç»“æœ</li>
        <li><strong>è°¨æ…ä½¿ç”¨ watchï¼š</strong>è¿‡å¤šçš„ watch å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œä¼˜å…ˆè€ƒè™‘è®¡ç®—å±æ€§</li>
        <li><strong>ä½¿ç”¨ shallow API ä¼˜åŒ–æ€§èƒ½ï¼š</strong>å¯¹äºå¤§å‹å¯¹è±¡ï¼Œè€ƒè™‘ä½¿ç”¨ shallowRef æˆ– shallowReactive</li>
        <li><strong>é¿å…åœ¨æ¨¡æ¿ä¸­è¿›è¡Œå¤æ‚è®¡ç®—ï¼š</strong>å°†å¤æ‚è®¡ç®—ç§»åˆ°è®¡ç®—å±æ€§ä¸­</li>
        <li><strong>æ­£ç¡®å¤„ç†å“åº”å¼æ•°æ®çš„ä¼ é€’ï¼š</strong>ä½¿ç”¨ toRef æˆ– toRefs ä¿æŒå“åº”æ€§</li>
      </ul>
    </section>
    
    <section class="section-card">
      <h2>å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ</h2>
      <div class="faq-grid">
        <div class="faq-item">
          <h3>â“ å“åº”æ€§ä¸¢å¤±</h3>
          <p><strong>é—®é¢˜ï¼š</strong>è§£æ„ reactive å¯¹è±¡åä¸¢å¤±å“åº”æ€§</p>
          <p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
          <ul>
            <li>ä½¿ç”¨ toRefs å°†å¯¹è±¡å±æ€§è½¬æ¢ä¸º ref</li>
            <li>ç›´æ¥ä½¿ç”¨ reactive å¯¹è±¡ï¼Œä¸è¿›è¡Œè§£æ„</li>
            <li>ä½¿ç”¨ ref æ›¿ä»£ reactive</li>
          </ul>
        </div>
        <div class="faq-item">
          <h3>â“ å¼‚æ­¥æ“ä½œä¸­çš„å“åº”æ€§</h3>
          <p><strong>é—®é¢˜ï¼š</strong>åœ¨å¼‚æ­¥æ“ä½œä¸­ä¿®æ”¹å“åº”å¼æ•°æ®ä¸è§¦å‘æ›´æ–°</p>
          <p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong>Vue 3 çš„å“åº”æ€§ç³»ç»Ÿèƒ½å¤Ÿè‡ªåŠ¨å¤„ç†å¼‚æ­¥æ“ä½œï¼Œç¡®ä¿åœ¨æ­£ç¡®çš„æ—¶æœºè§¦å‘æ›´æ–°</p>
        </div>
        <div class="faq-item">
          <h3>â“ æ€§èƒ½ä¼˜åŒ–</h3>
          <p><strong>é—®é¢˜ï¼š</strong>å¤§å‹åº”ç”¨ä¸­å“åº”æ€§ç³»ç»Ÿå¯¼è‡´æ€§èƒ½é—®é¢˜</p>
          <p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
          <ul>
            <li>ä½¿ç”¨ shallowRef å’Œ shallowReactive</li>
            <li>åˆç†ä½¿ç”¨ computed ç¼“å­˜è®¡ç®—ç»“æœ</li>
            <li>é¿å…ä¸å¿…è¦çš„å“åº”å¼æ•°æ®</li>
            <li>ä½¿ç”¨ effectScope ç®¡ç†å‰¯ä½œç”¨</li>
          </ul>
        </div>
        <div class="faq-item">
          <h3>â“ è°ƒè¯•å“åº”æ€§é—®é¢˜</h3>
          <p><strong>é—®é¢˜ï¼š</strong>æ— æ³•ç¡®å®šå“åº”å¼æ•°æ®ä½•æ—¶æ›´æ–°</p>
          <p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
          <ul>
            <li>ä½¿ç”¨ Vue DevTools è§‚å¯Ÿå“åº”å¼æ•°æ®</li>
            <li>æ·»åŠ  watch ä¸´æ—¶ç›‘æ§æ•°æ®å˜åŒ–</li>
            <li>æ£€æŸ¥ä¾èµ–å…³ç³»æ˜¯å¦æ­£ç¡®å»ºç«‹</li>
          </ul>
        </div>
      </div>
    </section>
  </div>
</template>

<script setup lang="ts">
// Reactivity page component
</script>

<style scoped>
.reactivity-page {
  padding: 1rem;
  max-width: 1000px;
  margin: 0 auto;
}

.page-description {
  font-size: 1.2rem;
  color: var(--color-text-secondary);
  margin-bottom: 2rem;
  text-align: center;
}

.section-card {
  background-color: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: 8px;
  padding: 1.5rem;
  margin-bottom: 2rem;
}

.section-card h2 {
  margin-top: 0;
  color: var(--color-text);
  border-bottom: 2px solid var(--color-primary);
  padding-bottom: 0.5rem;
}

.section-card ul {
  padding-left: 1.5rem;
}

.section-card li {
  margin-bottom: 0.5rem;
}

.comparison-grid,
.api-grid,
.faq-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.comparison-item,
.api-item,
.faq-item {
  background-color: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: 4px;
  padding: 1rem;
}

.comparison-item h3,
.api-item h3,
.faq-item h3 {
  margin-top: 0;
  color: var(--color-text);
}

.code-example {
  background-color: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: 4px;
  padding: 1rem;
  margin-top: 1rem;
  overflow-x: auto;
}

.code-example pre {
  margin: 0;
  font-family: 'Courier New', Courier, monospace;
  font-size: 0.9rem;
}
</style>
